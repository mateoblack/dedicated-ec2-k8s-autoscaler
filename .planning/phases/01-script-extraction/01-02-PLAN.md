---
phase: 01-script-extraction
plan: 02
type: execute
---

<objective>
Extract the 2 bootstrap script generation methods from compute-stack.ts into separate TypeScript modules under lib/scripts/.

Purpose: Reduce compute-stack.ts by an additional ~2,187 lines. Enable shellcheck linting in Phase 7.
Output: Two new TypeScript files exporting bootstrap script generation functions.
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-phase.md
./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-script-extraction/01-01-SUMMARY.md
@lib/compute-stack.ts
@lib/scripts/index.ts

**Constraints from PROJECT.md:**
- Behavior must remain identical (pure refactor)
- All 30 existing tests must pass after refactor

**Method locations in compute-stack.ts:**
- `createWorkerBootstrapScript`: lines 944-1346 (403 lines)
- `createControlPlaneBootstrapScript`: lines 1839-3622 (1784 lines)

**Pattern established in Plan 01:**
Export function matching original private method signature.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extract worker bootstrap script</name>
  <files>lib/scripts/worker-bootstrap.ts</files>
  <action>
1. Create `lib/scripts/worker-bootstrap.ts`
2. Copy the entire `createWorkerBootstrapScript` method body from compute-stack.ts (lines 944-1346)
3. Export as: `export function createWorkerBootstrapScript(clusterName: string): string`
4. The function returns the template literal containing the Bash script

DO NOT modify the Bash script content - this is a pure extraction.
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit lib/scripts/worker-bootstrap.ts`</verify>
  <done>File exists, exports function with correct signature, compiles without errors</done>
</task>

<task type="auto">
  <name>Task 2: Extract control plane bootstrap script</name>
  <files>lib/scripts/control-plane-bootstrap.ts</files>
  <action>
1. Create `lib/scripts/control-plane-bootstrap.ts`
2. Copy the entire `createControlPlaneBootstrapScript` method body from compute-stack.ts (lines 1839-3622)
3. Export as: `export function createControlPlaneBootstrapScript(clusterName: string, oidcProviderArn: string, oidcBucketName: string, etcdBackupBucketName: string): string`
4. The function returns the template literal containing the Bash script

This is the largest method (1784 lines). DO NOT modify the Bash script content - this is a pure extraction.
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit lib/scripts/control-plane-bootstrap.ts`</verify>
  <done>File exists, exports function with correct 4-parameter signature, compiles without errors</done>
</task>

<task type="auto">
  <name>Task 3: Update barrel file with bootstrap exports</name>
  <files>lib/scripts/index.ts</files>
  <action>
Update `lib/scripts/index.ts` to also export bootstrap script functions:

```typescript
// Lambda code generators
export { createEtcdLifecycleLambdaCode } from './etcd-lifecycle-lambda';
export { createEtcdBackupLambdaCode } from './etcd-backup-lambda';
export { createClusterHealthLambdaCode } from './cluster-health-lambda';

// Bootstrap script generators
export { createWorkerBootstrapScript } from './worker-bootstrap';
export { createControlPlaneBootstrapScript } from './control-plane-bootstrap';
```
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit lib/scripts/index.ts`</verify>
  <done>Barrel file exports all 5 functions (3 Lambda + 2 bootstrap)</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `lib/scripts/` directory has 6 files (5 scripts + index.ts)
- [ ] `npx tsc --noEmit` passes for all new files
- [ ] Each script file exports function with correct signature
- [ ] Barrel file re-exports all 5 functions
</verification>

<success_criteria>

- Both bootstrap script files created under lib/scripts/
- Barrel file updated to export all 5 functions
- TypeScript compilation succeeds
- No modifications to compute-stack.ts yet (that's Plan 03)
</success_criteria>

<output>
After completion, create `.planning/phases/01-script-extraction/01-02-SUMMARY.md`
</output>
